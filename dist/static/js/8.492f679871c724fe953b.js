webpackJsonp([8],{qY70:function(e,a){},ybv5:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("fZjL"),o=t.n(r),n=t("woOf"),i=t.n(n),s=t("Xxa5"),l=t.n(s),d=t("exGp"),c=t.n(d),u=t("8e4C"),m=t("Fd2+"),f=t("AQir"),p=t("Cmve"),h={data:function(){return{resTypes:u.c,amounts:u.a,takeGarbages:u.d,resTypesPopShow:!1,amountPopShow:!1,takeGarbagePopShow:!1,doorServStartTimePopShow:!1,doorServEndTimePopShow:!1,form:{},startDate:new Date,endDate:new Date,errors:{defaultAddr:"",mobilePhone:"",area:""},areaSelectShow:!1,areaList:p.a,id:this.$route.params.id,area:"",selectArea:"",defaultAddr:"",loading:!1,resImages:[]}},computed:{title:function(){return this.id?"更新回收":"发布回收"},btnTxt:function(){return this.id?"更新":"发布"}},watch:{$route:function(e,a){this.id=this.$route.params.id}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return c()(l.a.mark(function a(){var t;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.id){a.next=5;break}return t={id:e.id,bizType:3},a.next=4,e.$ajax("recyleDetail",t).then(function(a){e.form=a.data,e.resImages=e.form.resImages.split(","),e.form.addr=a.data.addr;var t=[],r=p.a.province_list[a.data.addr.provinceId],o=p.a.city_list[a.data.addr.cityId],n=p.a.county_list[a.data.addr.areaId];t.push(r),r!==o&&t.push(o),t.push(n),e.selectArea=a.data.addr.areaId,e.area=t.join("/"),e.defaultAddr=a.data.addr.addrDetail});case 4:return a.abrupt("return");case 5:return a.next=7,e.$ajax("getYezhuUserInfo").then(function(a){e.form.mobilePhone=a.data.mobilePhone,e.form.addr=a.data.defaultAddr;var t=[],r=p.a.province_list[a.data.defaultAddr.provinceId],o=p.a.city_list[a.data.defaultAddr.cityId],n=p.a.county_list[a.data.defaultAddr.areaId];t.push(r),r!==o&&t.push(o),t.push(n),e.selectArea=a.data.defaultAddr.areaId,e.area=t.join("/"),e.defaultAddr=a.data.defaultAddr.addrDetail});case 7:case"end":return a.stop()}},a,e)}))()},handleRestypeConfirm:function(e){this.form.resType=e.id,this.resTypesPopShow=!1},formatType:function(e){var a=u.c.filter(function(a){return a.id===+e});return a.length?a[0].label:"请选择"},handleAmountConfirm:function(e){this.form.resAmount=e.id,this.amountPopShow=!1},formatAmount:function(e){var a=u.a.filter(function(a){return a.id===+e});return a.length?a[0].label:"请选择"},handleTakeGarbageConfirm:function(e){this.form.takeGarbageFlag=e.id,this.takeGarbagePopShow=!1},formatTakegarbage:function(e){var a=u.d.filter(function(a){return a.id===e});return a.length?a[0].label:"请选择"},handleDoorServStartTimeConfirm:function(e){this.form.doorServStartTime=Object(f.a)(this.startDate,"yyyy-MM-dd hh:mm:ss"),this.doorServStartTimePopShow=!1},handledoorServEndTimeConfirm:function(e){this.form.doorServEndTime=Object(f.a)(this.endDate,"yyyy-MM-dd hh:mm:ss"),this.doorServEndTimePopShow=!1},formatter:function(e,a){return"year"===e?a+"年":"month"===e?a+"月":a},onRead:function(e){var a=this;return c()(l.a.mark(function t(){var r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.loading=!0,r={imgBase64:e.content,bizType:1},a.resImages=a.resImages||[],t.next=5,a.$ajax("upload",r).then(function(e){a.resImages.push(e.data)}).finally(function(){a.loading=!1});case 5:case"end":return t.stop()}},t,a)}))()},onClickLeft:function(){this.$router.go(-1)},handlePreviw:function(e){if(!e||!e.length)return this.$dialog.alert({message:"您还未上传照片"}),!1;Object(m.b)({images:e,startPosition:1,onClose:function(){}})},handleAreaSelect:function(e){var a=[],t=[];e.map(function(e){t.push(e.code),-1===a.indexOf(e.name)&&a.push(e.name)}),this.area=a.join("/"),this.form.addr=i()({},this.form.addr,{provinceId:t[0],cityId:t[1],areaId:t[2]}),this.areaSelectShow=!1,console.log(this.form)},submit:function(){var e=this;return c()(l.a.mark(function a(){var t,r;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.area?e.errors.area=null:e.errors.area="请填写",e.form.mobilePhone?e.errors.mobilePhone=null:e.errors.mobilePhone="请填写",e.form.mobilePhone&&(/^\d{11}$/.test(e.form.mobilePhone)?e.errors.mobilePhone=null:e.errors.mobilePhone="格式不正确"),e.defaultAddr?e.errors.defaultAddr=null:e.errors.defaultAddr="请填写",t=[],o()(e.errors).map(function(a){var r=e.errors[a]&&e.errors[a].toString();r&&t.push(r)}),!t.length){a.next=8;break}return a.abrupt("return",!1);case 8:if(e.form.resType){a.next=11;break}return e.$dialog.alert({message:"请选择回收类型"}),a.abrupt("return",!1);case 11:if(e.form.resAmount){a.next=14;break}return e.$dialog.alert({message:"请选择回收数量"}),a.abrupt("return",!1);case 14:if(e.resImages&&e.resImages.length){a.next=17;break}return e.$dialog.alert({message:"请上传回收照片"}),a.abrupt("return",!1);case 17:if("boolean"==typeof e.form.takeGarbageFlag){a.next=20;break}return e.$dialog.alert({message:"请选择是否带仍垃圾"}),a.abrupt("return",!1);case 20:if(!e.form.doorServStartTime||!e.form.doorServEndTime){a.next=25;break}if(!(new Date(e.form.doorServEndTime).getTime()-new Date(e.form.doorServStartTime).getTime()<=0)){a.next=25;break}return e.$dialog.alert({message:"上门服务时间选择不合理，请重新选择"}),a.abrupt("return",!1);case 25:return e.form.resImages=e.resImages.join(","),e.form.addr=i()(e.form.addr,{addrDetail:e.defaultAddr}),console.log(e.form),r=e.id?"updateRecyle":"createRecyle",a.next=31,e.$ajax(r,e.form,{showSuccessMsg:!0});case 31:e.$router.push("/owner");case 32:case"end":return a.stop()}},a,e)}))()},handleCancel:function(){this.areaSelectShow=!1}}},v={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{attrs:{id:"publish-container"}},[t("van-nav-bar",{attrs:{title:e.title,"left-text":"返回","right-text":"","left-arrow":""},on:{"click-left":e.onClickLeft}}),e._v(" "),t("div",{staticClass:"detail-content"},[t("van-cell-group",[t("van-cell",{attrs:{title:"回收类型",value:e.formatType(e.form.resType)},on:{click:function(a){e.resTypesPopShow=!0}}}),e._v(" "),t("van-cell",{attrs:{title:"数量",value:e.formatAmount(e.form.resAmount)},on:{click:function(a){e.amountPopShow=!0}}}),e._v(" "),t("van-cell",{attrs:{title:"照片"}},[!e.resImages||e.resImages.length<3?t("van-uploader",{attrs:{slot:"right-icon","after-read":e.onRead},slot:"right-icon"},[t("van-button",{attrs:{type:"default",size:"small"}},[e._v("上传")])],1):e._e()],1),e._v(" "),e.resImages&&e.resImages.length?t("van-cell",[e._l(e.resImages,function(e,a){return t("div",{key:a,staticClass:"resImage"},[t("img",{attrs:{src:e}})])}),e._v(" "),t("van-button",{attrs:{slot:"right-icon",type:"default",size:"small"},on:{click:function(a){e.handlePreviw(e.resImages)}},slot:"right-icon"},[e._v("预览")])],2):e._e(),e._v(" "),t("van-field",{attrs:{label:"所在地区",required:"",placeholder:"选择 省 / 市 / 区",readonly:"","error-message":e.errors.area,autosize:""},on:{focus:function(a){a.preventDefault(),e.areaSelectShow=!0}},model:{value:e.area,callback:function(a){e.area=a},expression:"area"}}),e._v(" "),t("van-field",{attrs:{label:"住址",required:"",placeholder:"请输入您的小区地址",autosize:"","error-message":e.errors.defaultAddr},model:{value:e.defaultAddr,callback:function(a){e.defaultAddr=a},expression:"defaultAddr"}}),e._v(" "),t("van-cell",{attrs:{title:"是否帮忙带扔垃圾",value:e.formatTakegarbage(e.form.takeGarbageFlag)},on:{click:function(a){e.takeGarbagePopShow=!0}}}),e._v(" "),t("van-cell",{attrs:{title:"上门服务时间段起点",value:e.form.doorServStartTime||"任意时间段"},on:{click:function(a){e.doorServStartTimePopShow=!0}}}),e._v(" "),t("van-cell",{attrs:{title:"上门服务时间段止点",value:e.form.doorServEndTime||"任意时间段"},on:{click:function(a){e.doorServEndTimePopShow=!0}}}),e._v(" "),t("van-field",{attrs:{label:"手机号",required:"",placeholder:"请输入手机号","error-message":e.errors.mobilePhone},model:{value:e.form.mobilePhone,callback:function(a){e.$set(e.form,"mobilePhone",a)},expression:"form.mobilePhone"}}),e._v(" "),t("van-field",{attrs:{label:"备注",type:"textarea",placeholder:"请输入备注",rows:"2",autosize:""},model:{value:e.form.resNote,callback:function(a){e.$set(e.form,"resNote",a)},expression:"form.resNote"}})],1),e._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-button",{attrs:{type:"primary",block:""},on:{click:e.submit}},[e._v(e._s(e.btnTxt))])],1)],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.resTypesPopShow,callback:function(a){e.resTypesPopShow=a},expression:"resTypesPopShow"}},[t("van-picker",{attrs:{columns:e.resTypes,"value-key":"label","show-toolbar":"",title:"回收类型"},on:{confirm:e.handleRestypeConfirm,cancel:function(a){e.resTypesPopShow=!1}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.amountPopShow,callback:function(a){e.amountPopShow=a},expression:"amountPopShow"}},[t("van-picker",{attrs:{columns:e.amounts,"value-key":"label","show-toolbar":"",title:"数量"},on:{confirm:e.handleAmountConfirm,cancel:function(a){e.amountPopShow=!1}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.takeGarbagePopShow,callback:function(a){e.takeGarbagePopShow=a},expression:"takeGarbagePopShow"}},[t("van-picker",{attrs:{columns:e.takeGarbages,"value-key":"label","show-toolbar":"",title:"带扔垃圾"},on:{confirm:e.handleTakeGarbageConfirm,cancel:function(a){e.takeGarbagePopShow=!1}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.doorServStartTimePopShow,callback:function(a){e.doorServStartTimePopShow=a},expression:"doorServStartTimePopShow"}},[t("van-datetime-picker",{attrs:{type:"datetime","min-date":new Date,formatter:e.formatter},on:{confirm:e.handleDoorServStartTimeConfirm,cancel:function(a){e.doorServStartTimePopShow=!1}},model:{value:e.startDate,callback:function(a){e.startDate=a},expression:"startDate"}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.doorServEndTimePopShow,callback:function(a){e.doorServEndTimePopShow=a},expression:"doorServEndTimePopShow"}},[t("van-datetime-picker",{attrs:{type:"datetime","min-date":e.startDate,formatter:e.formatter},on:{confirm:e.handledoorServEndTimeConfirm,cancel:function(a){e.doorServEndTimePopShow=!1}},model:{value:e.endDate,callback:function(a){e.endDate=a},expression:"endDate"}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:e.areaSelectShow,callback:function(a){e.areaSelectShow=a},expression:"areaSelectShow"}},[t("van-area",{attrs:{"area-list":e.areaList,value:e.selectArea},on:{confirm:e.handleAreaSelect,cancel:e.handleCancel}})],1)],1),e._v(" "),e.loading?t("van-loading",{staticClass:"loading",attrs:{color:"white"}}):e._e()],1)},staticRenderFns:[]};var b=t("VU/8")(h,v,!1,function(e){t("qY70")},"data-v-4487ab27",null);a.default=b.exports}});
//# sourceMappingURL=8.492f679871c724fe953b.js.map