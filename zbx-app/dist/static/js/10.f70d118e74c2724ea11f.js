webpackJsonp([10],{orQR:function(e,a){},ybv5:function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=r("fZjL"),o=r.n(t),n=r("woOf"),i=r.n(n),s=r("Xxa5"),l=r.n(s),d=r("exGp"),c=r.n(d),u=r("8e4C"),m=r("Fd2+"),f=r("AQir"),p=r("Cmve"),h={data:function(){return{resTypes:u.c,amounts:u.a,takeGarbages:u.d,resTypesPopShow:!1,amountPopShow:!1,takeGarbagePopShow:!1,doorServStartTimePopShow:!1,doorServEndTimePopShow:!1,form:{},startDate:new Date,endDate:new Date,errors:{defaultAddr:"",mobilePhone:"",area:""},areaSelectShow:!1,areaList:p.a,id:this.$route.params.id,area:"",selectArea:"",defaultAddr:"",loading:!1,resImages:[]}},computed:{title:function(){return this.id?"更新回收":"发布回收"},btnTxt:function(){return this.id?"更新":"发布"}},watch:{$route:function(e,a){this.id=this.$route.params.id}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return c()(l.a.mark(function a(){var r;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.id){a.next=5;break}return r={id:e.id,bizType:3},a.next=4,e.$ajax("recyleDetail",r).then(function(a){e.form=a.data,e.resImages=e.form.resImages.split(","),e.form.addr=a.data.addr;var r=[],t=p.a.province_list[a.data.addr.provinceId],o=p.a.city_list[a.data.addr.cityId],n=p.a.county_list[a.data.addr.areaId];r.push(t),t!==o&&r.push(o),r.push(n),e.selectArea=a.data.addr.areaId,e.area=r.join("/"),e.defaultAddr=a.data.addr.addrDetail});case 4:return a.abrupt("return");case 5:return a.next=7,e.$ajax("getYezhuUserInfo").then(function(a){var r=a.data.defaultAddr||{areaId:"330102",cityId:"330100",provinceId:"330000"};e.form.mobilePhone=a.data.mobilePhone,e.form.addr=r,e.form.takeGarbageFlag=!1;var t=[],o=p.a.province_list[r.provinceId],n=p.a.city_list[r.cityId],i=p.a.county_list[r.areaId];t.push(o),o!==n&&t.push(n),t.push(i),e.selectArea=r.areaId,e.area=t.join("/"),e.defaultAddr=r.addrDetail});case 7:case"end":return a.stop()}},a,e)}))()},handleRestypeConfirm:function(e){this.form.resType=e.id,this.resTypesPopShow=!1},formatType:function(e){var a=u.c.filter(function(a){return a.id===+e});return a.length?a[0].label:"请选择"},handleAmountConfirm:function(e){this.form.resAmount=e.id,this.amountPopShow=!1},formatAmount:function(e){var a=u.a.filter(function(a){return a.id===+e});return a.length?a[0].label:"请选择"},handleTakeGarbageConfirm:function(e){this.form.takeGarbageFlag=e.id,this.takeGarbagePopShow=!1},formatTakegarbage:function(e){var a=u.d.filter(function(a){return a.id===e});return a.length?a[0].label:"请选择"},handleDoorServStartTimeConfirm:function(e){this.form.doorServStartTime=Object(f.a)(this.startDate,"yyyy-MM-dd hh:mm:ss"),this.doorServStartTimePopShow=!1},handledoorServEndTimeConfirm:function(e){this.form.doorServEndTime=Object(f.a)(this.endDate,"yyyy-MM-dd hh:mm:ss"),this.doorServEndTimePopShow=!1},formatter:function(e,a){return"year"===e?a+"年":"month"===e?a+"月":a},onRead:function(e){var a=this;return c()(l.a.mark(function r(){var t;return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a.loading=!0,t={imgBase64:e.content,bizType:2},a.resImages=a.resImages||[],r.next=5,a.$ajax("upload",t).then(function(e){a.resImages.push(e.data)}).finally(function(){a.loading=!1});case 5:case"end":return r.stop()}},r,a)}))()},onClickLeft:function(){this.$router.go(-1)},handlePreviw:function(e){if(!e||!e.length)return this.$dialog.alert({message:"您还未上传照片"}),!1;Object(m.b)({images:e,startPosition:1,onClose:function(){}})},handleAreaSelect:function(e){var a=[],r=[];e.map(function(e){r.push(e.code),-1===a.indexOf(e.name)&&a.push(e.name)}),this.area=a.join("/"),this.form.addr=i()({},this.form.addr,{provinceId:r[0],cityId:r[1],areaId:r[2]}),this.areaSelectShow=!1,console.log(this.form)},submit:function(){var e=this;return c()(l.a.mark(function a(){var r,t;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.area?e.errors.area=null:e.errors.area="请填写",e.form.mobilePhone?e.errors.mobilePhone=null:e.errors.mobilePhone="请填写",e.form.mobilePhone&&(/^\d{11}$/.test(e.form.mobilePhone)?e.errors.mobilePhone=null:e.errors.mobilePhone="格式不正确"),e.defaultAddr?e.errors.defaultAddr=null:e.errors.defaultAddr="请填写",r=[],o()(e.errors).map(function(a){var t=e.errors[a]&&e.errors[a].toString();t&&r.push(t)}),!r.length){a.next=8;break}return a.abrupt("return",!1);case 8:if(e.form.resType){a.next=11;break}return e.$dialog.alert({message:"请选择回收类型"}),a.abrupt("return",!1);case 11:if(e.form.resAmount){a.next=14;break}return e.$dialog.alert({message:"请选择回收数量"}),a.abrupt("return",!1);case 14:if(e.resImages&&e.resImages.length){a.next=17;break}return e.$dialog.alert({message:"请上传回收照片"}),a.abrupt("return",!1);case 17:if("boolean"==typeof e.form.takeGarbageFlag){a.next=20;break}return e.$dialog.alert({message:"请选择是否带仍垃圾"}),a.abrupt("return",!1);case 20:if(!e.form.doorServStartTime||!e.form.doorServEndTime){a.next=25;break}if(!(new Date(e.form.doorServEndTime).getTime()-new Date(e.form.doorServStartTime).getTime()<=0)){a.next=25;break}return e.$dialog.alert({message:"上门服务时间选择不合理，请重新选择"}),a.abrupt("return",!1);case 25:return e.form.resImages=e.resImages.join(","),e.form.addr=i()(e.form.addr,{addrDetail:e.defaultAddr}),console.log(e.form),t=e.id?"updateRecyle":"createRecyle",a.next=31,e.$ajax(t,e.form,{showSuccessMsg:!0});case 31:e.$router.push("/owner");case 32:case"end":return a.stop()}},a,e)}))()},handleCancel:function(){this.areaSelectShow=!1}}},v={render:function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("div",{attrs:{id:"publish-container"}},[r("van-nav-bar",{attrs:{title:e.title,"left-text":"返回","right-text":"","left-arrow":""},on:{"click-left":e.onClickLeft}}),e._v(" "),r("div",{staticClass:"detail-content"},[r("van-cell-group",[r("van-cell",{attrs:{title:"回收类型",value:e.formatType(e.form.resType)},on:{click:function(a){e.resTypesPopShow=!0}}}),e._v(" "),r("van-cell",{attrs:{title:"数量",value:e.formatAmount(e.form.resAmount)},on:{click:function(a){e.amountPopShow=!0}}}),e._v(" "),r("van-cell",{attrs:{title:"照片"}},[!e.resImages||e.resImages.length<3?r("van-uploader",{attrs:{slot:"right-icon","after-read":e.onRead},slot:"right-icon"},[r("van-button",{attrs:{type:"default",size:"small"}},[e._v("上传")])],1):e._e()],1),e._v(" "),e.resImages&&e.resImages.length?r("van-cell",[e._l(e.resImages,function(e,a){return r("div",{key:a,staticClass:"resImage"},[r("img",{attrs:{src:e}})])}),e._v(" "),r("van-button",{attrs:{slot:"right-icon",type:"default",size:"small"},on:{click:function(a){e.handlePreviw(e.resImages)}},slot:"right-icon"},[e._v("预览")])],2):e._e(),e._v(" "),r("van-field",{attrs:{label:"所在地区",required:"",placeholder:"选择 省 / 市 / 区",readonly:"","error-message":e.errors.area,autosize:""},on:{focus:function(a){a.preventDefault(),e.areaSelectShow=!0}},model:{value:e.area,callback:function(a){e.area=a},expression:"area"}}),e._v(" "),r("van-field",{attrs:{label:"住址",required:"",placeholder:"请输入您的小区地址",autosize:"","error-message":e.errors.defaultAddr},model:{value:e.defaultAddr,callback:function(a){e.defaultAddr=a},expression:"defaultAddr"}}),e._v(" "),r("van-cell",{attrs:{title:"是否帮忙带扔垃圾",value:e.formatTakegarbage(e.form.takeGarbageFlag)},on:{click:function(a){e.takeGarbagePopShow=!0}}}),e._v(" "),r("van-cell",{attrs:{title:"上门服务时间段起点",value:e.form.doorServStartTime||"任意时间段"},on:{click:function(a){e.doorServStartTimePopShow=!0}}}),e._v(" "),r("van-cell",{attrs:{title:"上门服务时间段止点",value:e.form.doorServEndTime||"任意时间段"},on:{click:function(a){e.doorServEndTimePopShow=!0}}}),e._v(" "),r("van-field",{attrs:{label:"手机号",required:"",placeholder:"请输入手机号","error-message":e.errors.mobilePhone},model:{value:e.form.mobilePhone,callback:function(a){e.$set(e.form,"mobilePhone",a)},expression:"form.mobilePhone"}}),e._v(" "),r("van-field",{attrs:{label:"备注",type:"textarea",placeholder:"请输入备注",rows:"2",autosize:""},model:{value:e.form.resNote,callback:function(a){e.$set(e.form,"resNote",a)},expression:"form.resNote"}})],1),e._v(" "),r("van-row",[r("van-col",{attrs:{span:"24"}},[r("van-button",{attrs:{type:"primary",block:""},on:{click:e.submit}},[e._v(e._s(e.btnTxt))])],1)],1),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.resTypesPopShow,callback:function(a){e.resTypesPopShow=a},expression:"resTypesPopShow"}},[r("van-picker",{attrs:{columns:e.resTypes,"value-key":"label","show-toolbar":"",title:"回收类型"},on:{confirm:e.handleRestypeConfirm,cancel:function(a){e.resTypesPopShow=!1}}})],1),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.amountPopShow,callback:function(a){e.amountPopShow=a},expression:"amountPopShow"}},[r("van-picker",{attrs:{columns:e.amounts,"value-key":"label","show-toolbar":"",title:"数量"},on:{confirm:e.handleAmountConfirm,cancel:function(a){e.amountPopShow=!1}}})],1),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.takeGarbagePopShow,callback:function(a){e.takeGarbagePopShow=a},expression:"takeGarbagePopShow"}},[r("van-picker",{attrs:{columns:e.takeGarbages,"value-key":"label","show-toolbar":"",title:"带扔垃圾"},on:{confirm:e.handleTakeGarbageConfirm,cancel:function(a){e.takeGarbagePopShow=!1}}})],1),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.doorServStartTimePopShow,callback:function(a){e.doorServStartTimePopShow=a},expression:"doorServStartTimePopShow"}},[r("van-datetime-picker",{attrs:{type:"datetime","min-date":new Date,formatter:e.formatter},on:{confirm:e.handleDoorServStartTimeConfirm,cancel:function(a){e.doorServStartTimePopShow=!1}},model:{value:e.startDate,callback:function(a){e.startDate=a},expression:"startDate"}})],1),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.doorServEndTimePopShow,callback:function(a){e.doorServEndTimePopShow=a},expression:"doorServEndTimePopShow"}},[r("van-datetime-picker",{attrs:{type:"datetime","min-date":e.startDate,formatter:e.formatter},on:{confirm:e.handledoorServEndTimeConfirm,cancel:function(a){e.doorServEndTimePopShow=!1}},model:{value:e.endDate,callback:function(a){e.endDate=a},expression:"endDate"}})],1),e._v(" "),r("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:e.areaSelectShow,callback:function(a){e.areaSelectShow=a},expression:"areaSelectShow"}},[r("van-area",{attrs:{"area-list":e.areaList,value:e.selectArea},on:{confirm:e.handleAreaSelect,cancel:e.handleCancel}})],1)],1),e._v(" "),e.loading?r("van-loading",{staticClass:"loading",attrs:{color:"white"}}):e._e()],1)},staticRenderFns:[]};var b=r("VU/8")(h,v,!1,function(e){r("orQR")},"data-v-2a097ebf",null);a.default=b.exports}});
//# sourceMappingURL=10.f70d118e74c2724ea11f.js.map